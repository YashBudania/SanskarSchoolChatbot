<script>
const chat = document.getElementById("chat");

const GOOGLE_API_KEY = "PASTE_YOUR_GOOGLE_API_KEY_HERE";

/* ===== SCHOOL KNOWLEDGE BASE ===== */
const knowledge = [
  {
    keywords: ["school", "sanskar"],
    reply: "Sanskar School Jaipur is an educational institution focused on academics, discipline, values, and overall student development."
  },
  {
    keywords: ["principal"],
    reply: "The Principal of Sanskar School Jaipur is responsible for academic leadership, discipline, and administration of the school."
  },
  {
    keywords: ["admission"],
    reply: "Admission at Sanskar School Jaipur is done through the school office as per seat availability and school guidelines."
  },
  {
    keywords: ["facilities"],
    reply: "The school provides classrooms, library, laboratories, sports facilities, and a disciplined learning environment."
  }
];

/* ===== CHAT UI ===== */
function botMessage(text) {
  chat.innerHTML += `<div class="bot">${text}</div>`;
  chat.scrollTop = chat.scrollHeight;
  speak(text);
}

function userMessage(text) {
  chat.innerHTML += `<div class="user">${text}</div>`;
  chat.scrollTop = chat.scrollHeight;
}

/* ===== MAIN SEND FUNCTION ===== */
async function send() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  userMessage(text);
  input.value = "";

  const lower = text.toLowerCase();
  let found = false;

  for (let item of knowledge) {
    for (let key of item.keywords) {
      if (lower.includes(key)) {
        botMessage(item.reply);
        found = true;
        break;
      }
    }
    if (found) break;
  }

  if (!found) {
    botMessage("Thinking...");
    const aiReply = await googleAI(text);
    chat.lastChild.remove();
    botMessage(aiReply);
  }
}

/* ===== GOOGLE GEMINI AI ===== */
async function googleAI(question) {
  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GOOGLE_API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: question }] }]
        })
      }
    );

    const data = await response.json();
    return data.candidates[0].content.parts[0].text;

  } catch (error) {
    return "Sorry, I am unable to connect to Google AI right now.";
  }
}

/* ===== VOICE INPUT ===== */
function voice() {
  if (!('webkitSpeechRecognition' in window)) {
    alert("Voice not supported");
    return;
  }
  const rec = new webkitSpeechRecognition();
  rec.lang = "en-IN";
  rec.start();
  rec.onresult = e => {
    document.getElementById("userInput").value = e.results[0][0].transcript;
    send();
  };
}

/* ===== VOICE OUTPUT ===== */
function speak(text) {
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-IN";
  speechSynthesis.speak(msg);
}

window.onload = () => {
  botMessage("Hello! I am the Master AI Chatbot of Sanskar School Jaipur.");
};
</script>


</body>
</html>

